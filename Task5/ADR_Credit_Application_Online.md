### <a name="_b7urdng99y53"></a>**Название задачи:** Онлайн-кредитный процесс
### <a name="_hjk0fkfyohdk"></a>**Автор:** Степанова Айман
### <a name="_uanumrh8zrui"></a>**Дата:** 26.10.2025

## Контекст и цель
Команда цифровой трансформации инициировала цифровизацию кредитного направления.  
Клиенты должны иметь возможность подать заявку на кредит в **интернет-банке** и **на сайте**.  
При заполнении паспортных данных система должна выдать **предварительное решение** через интеграцию со скорингом, используя данные БКИ.  
При одобрении клиент получает СМС и направляется на **идентификацию в отделение**.  
Если клиент уже подавал заявку онлайн, менеджер в АБС должен продолжить работу с той же заявкой, без дублирования.  
В интернет-банке клиент может видеть **предодобренные предложения** и подавать заявку с подтверждением через OTP (одноразовый СМС-код).


### <a name="_3bfxc9a45514"></a>**Функциональные требования**

| № | Действующие лица / системы                       | Use Case                          | Описание                                                                                                                                                                             |
|:-:|--------------------------------------------------|-----------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 1 | Клиент → Сайт → CAS (Credit Application Service) | Подача новой заявки на сайте      | Клиент вводит ФИО и телефон (F11), при наличии паспортных данных CAS инициирует онлайн-скоринг и получает предварительное решение.                                                   |
| 2 | Клиент → Интернет-банк → CAS                     | Подача заявки в интернет-банке    | Авторизованный клиент видит список кредитов и предодобренные предложения (F14), указывает счёт для зачисления, подтверждает подачу заявки через одноразовый СМС-код (OTP) (F7, F15). |
| 3 | CAS → Кредитный конвейер, Скоринг                | Скоринг заявки                    | CAS направляет данные в систему скоринга, при необходимости получает результат из Кредитного конвейера (F11, F15).                                                                   |
| 4 | Клиент → CAS → СМС-шлюз                          | Уведомление о статусе заявки      | После обработки CAS отправляет СМС об изменении статуса (F16, F17).                                                                                                                  |
| 5 | Менеджер → АБС → Конвейер                        | Продолжение онлайн-заявки в офисе | Менеджер в АБС продолжает работу с заявкой клиента, созданной онлайн (F13).                                                                                                          |
| 6 | Новый клиент → Отделение                         | Очная идентификация               | Для полностью нового клиента проводится идентификация в офисе (F4, +R1).                                                                                                             |

---

### <a name="_u8xz25hbrgql"></a>**Нефункциональные требования**

| Код     | Требование                                                                                                                    |
|---------|-------------------------------------------------------------------------------------------------------------------------------|
| **R1**  | Шифрование трафика HTTPS/TLS для всех каналов (сайт, ИБ).                                                                     |
| **R2**  | Исключить прямые вызовы API АБС из интернет-банка; все обращения идут через CAS.                                              |
| **R3**  | Доступность CAS и ИБ не ниже 99,9 %, поддержка режима 24/7.                                                                   |
| **R4**  | Поддержка аварийного переключения на резервный ЦОД.                                                                           |
| **P1**  | Время отклика интерфейсов ≤ 1 с, исключить задержки загрузки справочников.                                                    |
| **P2**  | Интернет-банк и CAS должны поддерживать горизонтальное масштабирование и балансировку нагрузки.                               |
| **P3**  | Система скоринга не должна нагружаться дополнительными предрасчётами; допускается вызов только при фактической подаче заявки. |
| **S1**  | Использование MS SQL и Java/Spring Boot, совместимых с текущими платформами банка.                                            |
| **S2**  | Разработка документации и технических описаний для дальнейшего расширения процесса.                                           |
| **S3**  | Применение технологий, по которым есть внутренняя экспертиза.                                                                 |
| **S4**  | В перспективе — использование Kafka как стандартной шины событий.                                                             |
| **+R1** | Обязательная очная идентификация новых клиентов.                                                                              |
| **+R2** | Текущая версия интернет-банка не должна зависеть от Kafka.                                                                    |
| **+R3** | АБС масштабируется только вертикально.                                                                                        |
| **+R4** | Исключить дополнительные онлайн-нагрузки на БД АБС.                                                                           |
| **+R5** | Обмен заявками между АБС и Кредитным конвейером осуществляется не чаще раза в сутки.                                          |

---

### <a name="_qmphm5d6rvi3"></a>**Решение**

Вводится промежуточный сервис **CAS (Credit Application Service)**.  
Он принимает заявки с сайта и интернет-банка, вызывает скоринг при необходимости, хранит статусы и уведомляет клиента через СМС.  
CAS синхронизируется с Кредитным конвейером и АБС пакетно (раз в сутки, +R5).

Таким образом:
- фронты (сайт, ИБ) работают онлайн,
- АБС не испытывают лишней нагрузки,(+R4)
- не нагружаем скоринг предрасчётами (P3)
- соблюдаются требования безопасности (R1, F10).

## Диаграмма контекста (C4-C1)

- [Диаграмма контекста](credit_context.puml)
- [Диаграмма компонентов](credit_component.puml)

### <a name="_bjrr7veeh80c"></a>**Альтернативы**

| Вариант                             | Плюсы                   | Минусы                                        |
|-------------------------------------|-------------------------|-----------------------------------------------|
| **Прямые интеграции сайт/ИБ ↔ АБС** | Просто логически        | Нарушает +R4, +R5; перегружает АБС            |
| **Единый поток через Kafka**        | Асинхронность и масштаб | Нарушает +R2 (ИБ несовместим с Kafka)         |
| **Вендорская LOS/LMS-платформа**    | Быстрая реализация      | Вендор-lock-in, несоответствие стеку (S1, S3) |

---

## Ограничения решения
- Очная идентификация новых клиентов обязательна (+R1).
- Онлайн-скоринг — только по данным БКИ, без дополнительных расчётов (P3).
- Обмен с АБС и Конвейером — пакетный, не чаще 1 р/сутки (+R5).
- Интернет-банк работает по REST, без Kafka (+R2).
- АБС масштабируется вертикально (+R3).
- В MVP нет ESB, пакетный обмен — только через БД-интеграцию; частоту увеличить нельзя (+R5).
---

## Риски и меры снижения
| Риск                                     | Меры снижения                                                  |
|------------------------------------------|----------------------------------------------------------------|
| Ошибка при скоринге или задержка ответа  | Ретраи, лог отказов, уведомление клиента                       |
| Перегрузка скоринга                      | Ограничение вызовов (только при фактической подаче заявки, P3) |
| Несогласованность данных между CAS и АБС | Пакетная синхронизация, аудит и ручная сверка                  |
| Ошибки СМС-уведомлений                   | Повторная отправка, интеграция с резервным шлюзом              |
| Нарушение SLA                            | Мониторинг доступности CAS и интеграций (R3, R4)               |
| отказ/задержка ночного SQL-job           | «алерты + ручной перезапуск, журнал пакетов в CAS»             |
| рассинхронизация (частичные пакеты)      | идемпотентные ключи, контрольные суммы                         |
