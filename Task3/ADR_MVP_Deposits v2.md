### <a name="_b7urdng99y53"></a>**Название задачи:** Открытие депозитов — MVP: концептуальная архитектура
### <a name="_hjk0fkfyohdk"></a>**Автор:** Степанова Айман
### <a name="_uanumrh8zrui"></a>**Дата:** 25.10.2025

### <a name="_3bfxc9a45514"></a>**Функциональные требования**

Ниже приведены ключевые Use Cases для MVP открытия депозитов в интернет‑банке и на сайте банка. 
Каждый сценарий отражает основные действия пользователей и взаимодействие систем.

| **№** | **Действующие лица или системы**         | **Use Case**                          | **Описание**                                                                                                                                                                                                                                                                                                                                                     |
|:-----:|:-----------------------------------------|:--------------------------------------|:-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|   1   | Клиент → Сайт                            | Просмотр депозитов и подача заявки    | Новый клиент посещает сайт банка, просматривает список доступных депозитов с актуальными ставками и выбирает продукт. Клиент вводит ФИО и телефон и отправляет заявку. Сайт отправляет данные в сервис заявок. Данные передаются по защищённому каналу (HTTPS). На этапе MVP менеджер кол‑центра звонит клиенту, уточняет детали и сообщает условия по депозиту. |
|   2   | Клиент → Интернет‑банк                   | Просмотр депозитов и подача заявки    | Авторизованный клиент входит в интернет‑банк, видит список депозитов и персональные ставки. Клиент выбирает счёт и сумму, отправляет заявку. Операция подтверждается одноразовым СМС‑кодом. Заявка передаётся в сервис заявок на депозиты для дальнейшей обработки.                                                                                              |
|   3   | Менеджер кол‑центра → Система кол‑центра | Обработка заявок с сайта              | Менеджер получает заявку нового клиента из сервиса заявок, звонит клиенту, уточняет детали и при необходимости предлагает особые условия. Обращение фиксируется в системе кол‑центра и затем передаётся в АБС для расчёта ставки и дальнейшей обработки.                                                                                                         |
|   4   | Менеджер бэк‑офиса депозитов → АБС       | Рассмотрение заявки и открытие вклада | Бэк‑офис получает заявку, определяет ставку по депозиту. Ставки рассчитываются на основе Excel‑файлов, которые ежедневно обновляются и передаются в бэк‑офис. При необходимости запрашиваются специальные ставки у кредитного подразделения. После утверждения менеджер открывает депозит в АБС и подписывает документы. Клиент получает уведомление.            |
|   5   | Сервис заявок на депозиты, СМС‑шлюз      | Уведомления и подтверждения           | Сервис заявок отправляет клиенту СМС‑сообщения: одноразовый код для подтверждения действий в интернет‑банке, уведомление о подтверждении ставки и уведомление об открытии вклада. Необходимо обеспечить шифрование трафика и защиту персональных данных.                                                                                                         |

### <a name="_u8xz25hbrgql"></a>**Нефункциональные требования**

Архитектурно значимые требования и ограничения, влияющие на проектирование MVP:

| **№** | **Требование**                                                                                                                                                                                             |
|:-----:|:-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|   1   | Все данные, передаваемые между сайтом, интернет‑банком и внутренними сервисами, должны быть зашифрованы (HTTPS/TLS); операции в интернет‑банке подтверждаются одноразовым СМС‑кодом.                       |
|   2   | Интернет‑банк не должен вызывать АБС напрямую; связь осуществляется через промежуточный сервис или шину сообщений, чтобы снизить нагрузку на АБС.                                                          |
|   3   | Сервисы интернет‑банка и связанные компоненты должны обеспечивать доступность не ниже 99,9 % и работу в режиме 24/7; система должна поддерживать аварийное переключение на резервный ЦОД.                  |
|   4   | Время отклика операций должно составлять миллисекунды; загрузка справочников не должна превышать 1 секунды. Интернет‑банк должен поддерживать горизонтальное масштабирование и балансировку нагрузки.      |
|   5   | Решение должно использовать существующие в банке СУБД (MS SQL, Oracle) и быть совместимым с текущими платформами разработки; выбирать новые технологии следует с учётом внутренней экспертизы сотрудников. |
|   6   | При необходимости очередей сообщений предпочтительно использовать Kafka, но текущая версия интернет‑банка не должна зависеть от Kafka из‑за несовместимости.                                               |
|   7   | АБС масштабируется только вертикально; проект не должен добавлять дополнительную онлайн‑нагрузку на базу данных АБС; обмен заявками между АБС и другими системами остаётся пакетным.                       |
|   8   | На этапе MVP заявки на открытие вклада обрабатываются менеджером бэк‑офиса; новые клиенты проходят личную идентификацию в отделении банка.                                                                 |
|   9   | Интерфейс интернет‑банка и сайта должен соответствовать дизайн‑системе компании и быть удобным; количество шагов подачи заявки необходимо минимизировать.                                                  |

### <a name="_qmphm5d6rvi3"></a>**Решение**

В целях выполнения функциональных и нефункциональных требований предлагается следующий вариант концептуальной архитектуры MVP открытия депозитов:

**Контекст**

Клиентские интерфейсы. Сайт (PHP/React) и действующий интернет‑банк (ASP.NET MVC) отображают список доступных депозитов и позволяют клиентам подать заявку. Для авторизованных клиентов интернет‑банк дополнительно показывает персонализированные ставки и позволяет выбрать счёт и сумму для вклада. Все запросы шифруются по протоколу HTTPS, а подтверждение выполняется через СМС‑код.

Сервис заявок на депозиты. Новый микросервис, который принимает заявки от сайта и интернет‑банка по REST API, сохраняет их в собственной базе данных и передаёт информацию в другие системы. Сервис берёт актуальные ставки из файла Excel/базы данных, чтобы показать их пользователю и подготовить заявку. Он также взаимодействует с СМС‑шлюзом для отправки подтверждений и уведомлений. В рамках MVP сервис направляет заявки менеджерам кол‑центра и бэк‑офиса для ручной обработки.

Система кол‑центра. Менеджер кол‑центра получает заявку нового клиента, связывается с ним и фиксирует обращение. Система построена на React и Java Spring Boot и работает в инфраструктуре банка. По окончании звонка информация направляется в АБС.

АБС. Автоматизированная банковская система на Delphi/PL‑SQL, где открываются депозиты, ведётся бухгалтерский учёт и сохраняется история операций. АБС масштабируется вертикально и перегружена, поэтому прямые вызовы из интернет‑банка исключены. Менеджер бэк‑офиса обрабатывает заявки, определяет ставку и открывает депозит. АБС отправляет клиенту уведомления через СМС‑шлюз.

СМС‑шлюз. Используется для отправки одноразовых кодов и уведомлений; управляется IT‑отделом банка.

Разработанные диаграммы контекста и контейнеров приведены в файлах deposit_context.png и deposit_container.png в репозитории. На первой показаны действующие лица, интерфейсы и системы, а на второй – разбиение интернет‑банка и сервиса заявок на контейнеры, базы данных и интеграции.

**Логика выбора архитектуры**

Декомпозиция и изоляция нагрузки. Основной проблемой является перегруженная АБС и отсутствие публичных API для интернет‑банка. Поэтому интернет‑банк не должен обращаться в АБС напрямую, а заявки должны проходить через отдельный сервис. Это соответствует требованию R2 и позволяет контролировать нагрузку.

Микросервис для заявок. Создание отдельного сервиса заявок на депозиты позволяет вынести бизнес‑логику оформления депозитов из монолитного интернет‑банка, использовать современный стек (.NET Core) и обеспечить горизонтальное масштабирование. Сервис хранит заявки в своей базе данных и общается с АБС и системой кол‑центра через интеграционный слой. В дальнейшем сервис может эволюционировать в полноценный автоматический процесс.

Использование существующих систем. Решение не предусматривает значительных доработок ядра кол‑центра или АБС. Взаимодействие с кол‑центром выполняется через API, а бэк‑офис продолжает работать в АБС вручную на этапе MVP. Заявки на сайт и интернет‑банк проходят по одному и тому же процессу, что снижает сложность.

Временное хранение ставок в Excel/DB. Ставки по депозитам обновляются ежедневно и доступны в виде Excel‑файла, которым пользуются сотрудники депозитов и кредитов. Сервис считывает файл либо данные из выделенной БД и предоставляет актуальные ставки клиентам. В будущем хранение ставок может быть перенесено в АБС.

Уведомления через СМС‑шлюз. Поскольку бизнес хочет избежать доработки ядра СМС, сервис заявок использует существующий СМС‑шлюз. Отдельные темы СМС (подтверждение кода, уведомление о ставке, уведомление об открытии вклада) различаются логикой, но реализуются в одном компоненте.

Надёжность и масштабирование. Интернет‑банк и сервис заявок будут развёрнуты на двух ЦОДах и масштабироваться горизонтально под балансировщиком нагрузки, чтобы обеспечить требуемую доступность 99,9 %. Базы данных MS SQL и Oracle используются согласно политике банка.

### <a name="_bjrr7veeh80c"></a>**Альтернативы**

В ходе проектирования рассматривались другие варианты:

- **Прямая интеграция интернет‑банка с АБС.** Интернет‑банк может отправлять заявки напрямую в АБС, минуя промежуточный сервис. Это упростило бы архитектуру, но нарушает требование об отсутствии прямых вызовов АБС, повысит нагрузку на АБС и ограничит масштабируемость.
- **Расширение АБС API.** Можно было бы доработать АБС, чтобы она принимала онлайн‑заявки и предоставляла ставки по депозитам автоматически. Однако система масштабируется вертикально и сильно перегружена; доработка ядра потребовала бы больших затрат и рисков для работы банка.
- **Модуль в существующем интернет‑банке.** Возможна реализация всех функций прямо в монолитном интернет‑банке. Но монолит сложно масштабировать, обновление ядра зависит от подрядчика, а команда хочет развивать интернет‑банк по микросервисному подходу. Вынесение логики в отдельный сервис соответствует требованию по использованию существующих технологий с внутренней экспертизой и позволяет гибко развивать функциональность.
- **Событийная архитектура с Kafka.** Перспективный вариант — организовать обмен событиями через Kafka. Но текущая версия интернет‑банка несовместима с Kafka, поэтому для MVP выбран REST/файловый обмен. В будущем после модернизации интернет‑банка Kafka может быть внедрена для улучшения асинхронности.

**Недостатки, ограничения, риски**

Ручная обработка в MVP. На этапе MVP обработка заявок, расчёт ставок и открытие депозитов выполняется вручную бэк‑офисом и менеджерами кол‑центра. Это увеличивает время отклика и ограничивает масштабируемость. В дальнейшем потребуется автоматизировать процесс.

Хранение ставок в Excel. Использование Excel‑файла как источника ставок упрощает MVP, но повышает риск ошибок и потери данных. В долгосрочной перспективе ставки необходимо хранить в надёжном хранилище и управлять ими централизованно.

Интеграция с АБС. АБС имеет ограниченную масштабируемость и перегружена, поэтому интеграция может стать узким местом. Использование пакетного обмена снижает нагрузку, но увеличивает задержку обработки заявок. В будущем понадобится разработать API и оптимизировать производительность АБС.

Совместимость технологий. Банк использует несколько технологических стеков (ASP.NET, Java, PL‑SQL), что усложняет внедрение микросервисов. Команда должна учесть наличие внутренней экспертизы и подготовить документацию для дальнейшего развития системы.

Безопасность и конфиденциальность. Обработка персональных данных требует строгого соблюдения стандартов безопасности. Шифрование данных и авторизация должны быть реализованы во всех компонентах. Необходимо обеспечить контроль доступа между сотрудниками депозитов и кредитов и защиту канала связи с SMS‑шлюзом.