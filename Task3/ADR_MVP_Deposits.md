### <a name="_b7urdng99y53"></a>**Название задачи:** IB-ADR1 MVP Открытие депозитов онлайн
### <a name="_hjk0fkfyohdk"></a>**Автор:** Степанова Айман 
### <a name="_uanumrh8zrui"></a>**Дата:** 25.10.2025
### <a name="_3bfxc9a45514"></a>**Функциональные требования**

Ниже — ключевые сценарии для MVP решения для открытия депозита онлайн в интернет-банке. Промежуточное состояние (через 6 месяцев). Клиент может открыть депозит или накопительный счёт в интернет-банке. В MVP бэк-офис может обрабатывать заявки по старому процессу.

| № | Действующие лица/системы | Use Case                                | Описание                                                                                                   |
|:-:|:-------------------------|:----------------------------------------|:-----------------------------------------------------------------------------------------------------------|
| 1 | Клиент, Интернет‑банк    | Подать заявку на депозит                | Клиент выбирает продукт, вводит сумму и счёт, подтверждает действие СМС‑кодом.                             |
| 2 | Клиент, Сайт, Кол‑центр  | Оставить заявку на сайте                | Новый клиент оставляет ФИО и телефон. Менеджер кол‑центра перезванивает и может предложить особые условия. |
| 3 | Менеджер бэк‑офиса, АБС  | Обработать заявку                       | На этапе MVP менеджер подтверждает условия депозита в АБС. Клиент получает СМС‑уведомления.                |
| 4 | Клиент, Интернет‑банк    | Просмотреть доступные депозиты и ставки | интернет-банк показывает список и персонализированные ставки для текущего клиента.                         |
| 5 | Сотрудники бэк‑офиса     | Ведение ставок в XLS                    | На MVP ставки ведутся в XLS‑файлах с доступом для депо‑ и кредитного бэк‑офиса.                            |

## Нефункциональные и архитектурно‑значимые требования

- TLS/HTTPS для всех каналов сайта и интернет‑банка.  
- Исключить прямые онлайн‑вызовы АБС из Интернет‑банка; развязка через промежуточные сервисы/шину.  
- Доступность сервисов интернет-банка 99,9% и 24/7; аварийное переключение на резервный ЦОД.  
- Горизонтальная масштабируемость интернет-банка; АБС масштабируется только вертикально, нагрузку на её БД не увеличиваем.  
- Kafka как перспективный стандарт очередей, но текущая версия интернет-банка несовместима — не делаем жёсткую зависимость на MVP.  
- На MVP обработку заявок выполняет менеджер бэк‑офиса.

## Решение (концептуально)

### Ключевая идея
1) Интернет‑банк остаётся монолитом, но получает новый модуль «Deposits UI/Flow».  
2) Все обращения интернет-банка к внутренним процессам открытия депозитов идут в **Deposit Application Service** (интеграционный сервис в периметре интернет-банка), а не напрямую в АБС, чтобы не нагружать АБС и не связывать интернет-банка с её API/БД.  
3) На MVP **менеджер бэк‑офиса** продолжает оформлять депозит в АБС вручную по заявке; сервисы обеспечивают трассировку и уведомления через СМС‑шлюз.  
4) Поддерживается канал сайта: заявки с сайта попадают в систему кол‑центра; далее — ручная работа менеджера и уведомления клиенту.  
5) Данные ставок на MVP берутся из XLS (с доступом двух бэк‑офисов). При дальнейшем развитии — миграция справочников ставок в АБС/отдельный каталог ставок.

**Диаграммы**:  
- Контекст: [deposits_context.puml](deposits_context.puml)
- Контейнеры: `deposits_containers.puml`

### Основные решения по контейнерам
- **Internet Bank (ASP.NET MVC 4.5 + MS SQL)** — существующий монолит. Новый модуль UI/Flow для депозитов.  
- **Deposit Application Service (Java/Spring, MS SQL/Oracle)** — сервис при интернет-банке: принимает заявки из интернет-банка, ведёт их статусы, вызывает СМС‑уведомления, публикует задачи для бэк‑офиса; служит анти‑коррупционным слоем к АБС.  
- **Call Center System (React + Spring Boot, PostgreSQL)** — получает заявки сайта; менеджеры обрабатывают лиды.  
- **SMS Gateway** ↔ **Telco** — подтверждения операций (OTP) и уведомления.  
- **ABS (Oracle, PL/SQL)** — финальное оформление депозита (ручной процесс на MVP).  
- **Rates XLS Storage** — источник ставок до миграции.

### Покрытие Use Cases
- UC‑1/UC‑4: проходят через Internet Bank → Deposit Application Service → уведомления (OTP/информирование).  
- UC‑2: сайт → Call Center System → (при необходимости) заявка в АБС / связь с бэк‑офисом.  
- UC‑3: менеджер бэк‑офиса работает в АБС; статусы синхронизируются с сервисом заявок; клиент получает СМС.  
- UC‑5: ставки читаются из XLS (на чтение в интернет-банке/сервисе), изменение — только сотрудниками бэк‑офиса.

## Альтернативы (кратко)
- Прямые вызовы интернет-банк → АБС. Отклонено: перегрузка БД АБС, tight‑coupling, нарушение ограничений.  
- Полная событийная шина (Kafka) сразу. Отклонено на MVP: несовместимость текущего интернет-банка; высокая стоимость внедрения.  
- Промежуточная СУБД‑витрина + пакетная синхронизация с АБС — как компромисс для разгрузки АБС в дальнейшем релизе.

## Риски и ограничения
- Задержки при ручной обработке заявок бэк‑офисом.  
- Консистентность ставок в XLS и риск человеческого фактора.  
- Потенциальная временная сложность интеграции (анти‑коррупционный слой) между интернет-банком и АБС.  
- Невозможность использовать Kafka в интернет-банке на текущей версии → технический долг к фазе «автоматизация открытия».

## Источники/обоснования
- FURPS+ таблица: требования по функциям, NFR и ограничениям. См. файл «[FURPS_plus_bank.md](..%2FTask2%2FFURPS_plus_bank.md)».  
- Описания процессов открытия депозитов и ИТ‑ландшафта: см. файлы задания и брифа.

---

### Комментарии к диаграммам
- В контекстной диаграмме показаны каналы (сайт, интернет-банк), внешние участники (клиент, менеджер кол‑центра), корпоративные системы (АБС), SMS‑шлюз/телко и артефакты ставок (XLS).  
- В контейнерной диаграмме детализированы Internet Bank и ABS. Остальные системы оставлены как внешние/упрощённые, как допускает задание.