### <a name="_b7urdng99y53"></a>**Название задачи:** Получение актуальных ставок
### <a name="_hjk0fkfyohdk"></a>**Автор:** Степанова Айман
### <a name="_uanumrh8zrui"></a>**Дата:** 25.10.2025
### <a name="_3bfxc9a45514"></a>**Функциональные требования**

| **№** | **Действующие лица или системы**                                      | **Use Case**                               | **Описание**                                                              |
|:-----:|:----------------------------------------------------------------------|:-------------------------------------------|:--------------------------------------------------------------------------|
|   1   | Сотрудник бэк-офиса кредитования -> Rates Publisher                   | Загрузка таблицы со ставками депозитов     | Бэк-офис загружает и активирует новую версию ставок                       |
|   2   | Менеджер внутреннего кол-центра, система кол-центра,  Rates Publisher | Чтение таблицы со ставками депозитов       | Внутренний КЦ запрашивает ставки для консультации клиента                 |
|   3   | Rates Publisher -> Сотрудник партнерского кол-центра                  | Получение таблицы со ставками депозитов    | Система формирует и отправляет партнёру файл со ставками по расписанию    |
|   4   | Оператор 2-й линии/дежурный  -> Rates Publisher                       | Переотправка таблицы со ставками депозитов | Оператор инициирует внеплановую переотправку файла партнёру               |
|   5   | Клиент, сайт,         Rates Publisher                                 | Просмотр актуальной ставки на сайте        | Сайт должен отображать список доступных депозитов с актуальными ставками	 |

### <a name="_u8xz25hbrgql"></a>**Нефункциональные требования**

| **№** | **Требование**                                                                                                                             |
|:-----:|:-------------------------------------------------------------------------------------------------------------------------------------------|
|   1   | **Доступность** REST для КЦ ≥ 99,9%; **время отклика** p95 ≤ 100 мс (из кэша).                                                             |
|   2   | **Срок распространения** новой активной версии во внутренний КЦ ≤ 5 минут после активации.                                                 |
|   3   | **Доставка партнёру**: плановая — не реже **каждый час** (при изменениях) или ежедневно 08:00, внеплановая — по кнопке в течение 10 минут. |
|   4   | **Безопасность**: передача по TLS; почтовая отправка — только на белые списки, с DLP‑проверками, без ПДн.                                  |
|   5   | **Поддерживаемость**: Использование известных команде технологий MS SQL и Java; деплой в 2 ЦОД под балансировщиком.                        |
|   6   | **Надежность**: Деплой сервиса ставок в 2 ЦОД под балансировщиком. При сбое доставки - ручной или автоматический ретрай.                   |

### <a name="_qmphm5d6rvi3"></a>**Решение**
**Промежуточный сервис ставок (Rates Publisher): импорт из XLS → нормализация → хранилище → REST для внутренних систем + плановая файловая выгрузка партнёру.**
Решение содержит минималистичный UI для загрузки Excel и UI для поддержки, в котором авторизованный пользователь может вручную перезапустить процесс отправки выгрузки в партнерский call-центр.
MVP - сервис предоставляет API.
Целевое решение - все сервисы потребители информации о ставках подписываются на топик (не подходит для интернет банка (+R2), но его можно оставить на API).
- Плюсы:
     - Изолирует источник, при изменении способа поставки с Excel на UI+API+БД, потребители не пострадают, т.к. используют API.
      - даёт SLA, аудит, кэш и масштабирование;
      - не нагружает АБС;
      - работает с текущим процессом XLS;
      - есть возможность расширить решение с синхронной интеграции, на асинхронную через kafka.
- Минусы: Появляется новый компонент, требуется сопровождение и DevOps.

**Используемые технологии**: Java, Spring Boot, MS SQL, React
**Диаграммы**
- [Диаграмма контекста](./c4_rates_Context.puml)
- [Диаграмма контейнеров](./c4_rates_container.puml)
- [Диаграмма компонентов](./c4_rates_component.puml)

Учтенные требования:
[FURPS_plus_bank.md](..%2FTask2%2FFURPS_plus_bank.md)

| Код требования | Как учтено                                                                                                                                                |
|:--------------:|:----------------------------------------------------------------------------------------------------------------------------------------------------------|
|      F1	       | Сайт может получать актуальные ставки в сервисе по REST                                                                                                   |
|     S1,S3	     | База данных MS SQL, React и Java используются согласно политике банка и наличии экспертизы.                                                               |
|      +R1	      | Все интеграции используют зашифрованное соединение.                                                                                                       |
|      +R2	      | Новый процесс не добавлет нагрузки на API АБС из интернет‑банка.                                                                                          |
|      +R4	      | В решении нет добавленной нагрузки на БД АБС                                                                                                              |
|      P2	       | Сервис ставок будет развёрнут на двух ЦОДах и масштабироваться горизонтально под балансировщиком нагрузки, чтобы обеспечить требуемую доступность 99,9 %. |



### <a name="_bjrr7veeh80c"></a>**Альтернативы**
- **Давать кол‑центрам доступ к XLS напрямую (сетевой ресурс/шары).**
    - **Плюс**: Минимальные доработки.
    - **Минус**: Хрупко, нет аудита/версий, риск одновременного редактирования, нет SLA доставки партнёру, проблемы с безопасностью.

- **Сделать ставки частью АБС и раздавать из АБС.**
   - **Плюс**: Единый мастер‑данные в ядре.
   - **Минусы**: перегруженность БД АБС (ограничение +R4)
- **Событийная архитектура с Kafka.** Перспективный вариант — организовать обмен событиями через Kafka. Но текущая версия интернет‑банка несовместима с Kafka, поэтому для MVP выбран REST/email. В будущем после модернизации интернет‑банка Kafka может быть внедрена для улучшения асинхронности.

**Недостатки, ограничения, риски**


