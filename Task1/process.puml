@startuml
!include https://raw.githubusercontent.com/plantuml-stdlib/C4-PlantUML/master/C4_Container.puml
LAYOUT_LEFT_RIGHT()

title Схема интеграции приложений (AS-IS)

Person(customer, "Клиент")
Person(agent, "Сотрудник кол-центра")
Person(teller, "Сотрудник отделения")
Person(bo, "Сотрудник бэк-офиса")
Person(credit, "Сотрудник отдела кредитования")

System_Boundary(bank, "Банк") {
  System(abs, "АБС (Core Banking)", "Хранение счетов, депозиты, кредиты, выплаты")
  System(crm, "CRM кол-центра", "Создание обращений по звонкам")
  System(queue, "Кредитный конвейер", "Обработка кредитных заявок")
  System_Ext(scoring, "Скоринговая система", "API (онлайн скоринг)")
  System_Ext(bki, "Бюро кредитных историй", "API (онлайн запросы)")
  System_Ext(sms, "SMS-шлюз", "Оповещение клиентов")
  System_Ext(mail, "Email/Excel", "Ручной обмен файлами/письмами")
}

' Взаимодействия клиентов и сотрудников
Rel(customer, agent, "Звонок, уточнение по депозиту/ставке")
Rel(agent, crm, "Заводит обращение")
Rel(crm, abs, "Передача обращения/заявки", "Интеграция")

Rel(customer, teller, "Визит в отделение (депозит/кредит)")
Rel(teller, abs, "Оформление заявки/депозита", "Ввод данных")

' Депозитный поток (ручные шаги для ставки)
Rel(bo, mail, "Получает/отправляет Excel/письма по ставкам", "Ручной канал")
Rel(credit, mail, "Передаёт данные по риску (Excel/письмо)", "Ручной канал")
Rel(mail, bo, "Возврат ставки/параметров", "Ручной канал")
Rel(abs, sms, "Оповещение о ставке клиенту (если предрассчитана)", "SMS")

' Кредитный поток
Rel(abs, queue, "Пакет заявок раз в сутки", "Интеграция по БД (batch, daily)")
Rel(queue, scoring, "Онлайн-запрос скоринга", "API (sync)")
Rel(scoring, bki, "Онлайн-запросы БКИ", "API (sync)")
Rel(queue, abs, "Решение по заявке раз в сутки", "Интеграция по БД (batch, daily)")

' Ответственности
UpdateRelStyle(abs, sms, $textColor="black", $lineColor="#888888", $offsetX=0, $offsetY=0)
UpdateRelStyle(abs, queue, $textColor="black", $lineColor="#888888")
UpdateRelStyle(queue, abs, $textColor="black", $lineColor="#888888")
UpdateRelStyle(bo, mail, $lineColor="#cc8844")
UpdateRelStyle(credit, mail, $lineColor="#cc8844")
@enduml
